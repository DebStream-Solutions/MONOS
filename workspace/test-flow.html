<!DOCTYPE html>
<html>
<head>
    <title>Network Traffic</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {packages: ['corechart']});
        google.charts.setOnLoadCallback(initChart);

        let chart, data, options;

        function initChart() {
            // Initialize chart with empty data
            data = google.visualization.arrayToDataTable([
                ['Time', 'Download (Bytes/sec)', 'Upload (Bytes/sec)'],
            ]);

            options = {
                title: 'Network Traffic',
                curveType: 'function',
                legend: { position: 'bottom' },
                vAxis: { title: 'Bytes/sec' },
                hAxis: { title: 'Time' }
            };

            chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
            chart.draw(data, options);

            // Start fetching data every 5 seconds
            setInterval(fetchAndUpdateData, 5000);
        }

        function fetchAndUpdateData() {
            $.ajax({
                url: 'test-flow.php', // Your endpoint
                method: 'GET',
                success: function(response) {
                    // Add new data point to the chart
                    data.addRow([
                        response.time,
                        response.downloadRate,
                        response.uploadRate
                    ]);
                    chart.draw(data, options);
                },
                error: function() {
                    console.error("Failed to fetch data");
                }
            });
        }
    </script>
</head>
<body>
    <div id="curve_chart" style="width: 900px; height: 500px;"></div>
</body>
</html>
