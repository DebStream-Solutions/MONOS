<!DOCTYPE html>
<html>
<head>
    <title>Network Traffic</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {packages: ['corechart']});
        google.charts.setOnLoadCallback(initChart);
    
        let chart, data, options;
    
        function initChart() {
            // Initialize chart with empty data
            data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Time');
            data.addColumn('number', 'Download (Bytes/sec)');
            data.addColumn('number', 'Upload (Bytes/sec)');
    
            options = {
                title: 'Network Traffic',
                legend: { position: 'bottom' },
                vAxis: { title: 'Bytes/sec' },
                hAxis: { title: 'Time', format: 'HH:mm:ss' },
                curveType: 'function', // Smooth curves
                areaOpacity: 0.2, // Fill transparency (20%)
                series: {
                    0: { color: '#4285F4', lineWidth: 2 }, // Download (blue line)
                    1: { color: '#EA4335', lineWidth: 2 }  // Upload (red line)
                }
            };
    
            chart = new google.visualization.AreaChart(document.getElementById('curve_chart'));
            chart.draw(data, options);
    
            // Start fetching data every 5 seconds
            setInterval(fetchAndUpdateData, 5000);
        }
    
        function fetchAndUpdateData() {
            $.ajax({
                url: 'test-flow.php', // Your endpoint
                method: 'GET',
                success: function(response) {
                    // Convert time string into a Date object
                    const timeParts = response.time.split(':');
                    const now = new Date();
                    const time = new Date(now.getFullYear(), now.getMonth(), now.getDate(), timeParts[0], timeParts[1], timeParts[2]);
    
                    // Add new data point to the chart
                    data.addRow([time, response.downloadRate, response.uploadRate]);
                    chart.draw(data, options);
                },
                error: function() {
                    console.error("Failed to fetch data");
                }
            });
        }
    </script>
    
</head>
<body>
    <div id="curve_chart" style="width: 900px; height: 500px;"></div>
</body>
</html>
